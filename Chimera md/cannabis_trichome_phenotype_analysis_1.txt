Smart Agricultural Technology 3 (2023) 100111 
Contents lists available at ScienceDirect      
Smart Agricultural Technology  
journal homepage: www.journals.elsevier.com/smart-agricultural-technology  
Characterization of trichome phenotypes to assess maturation and flower  development in Cannabis sativa L. (cannabis) by automatic trichome  gland analysis  
D.B. Sutton a,*, Z.K. Punja b, G. Hamarneh a  
a School of Computing Science, Simon Fraser University, 8888 University Drive, Burnaby, B.C. V5A 1S6, Canada b School of Biological Sciences, Simon Fraser University, 8888 University Drive, Burnaby, B.C. V5A 1S6, Canada  
ARTICLE INFO  
Keywords:  
Cannabis trichomes  
Deep learning  
Phenotype  
Fluorescence  
Precision agriculture  
1. Introduction  
ABSTRACT  
Cannabis (Cannabis sativa L.) is cultivated by licensed producers in Canada for medicinal and recreational uses.  The recent legalization of this plant in 2018 has resulted in rapid expansion of the industry, with greenhouse  production representing the most common method of cultivation. Female cannabis plants produce inflorescences  that contain bracts densely covered by glandular trichomes, which synthesize a range of commercially important  cannabinoids (e.g., THC, CBD) as well as terpenes. Cannabinoid content and quality varies over the 8-week  flowering period to such an extent that the time of harvest can significantly impact product quality. Cannabis  flower maturation is accompanied by a transition in the color of trichome heads that progresses from clear to  milky to brown (amber) and can be seen visually using low magnification. However, the importance of this  transition as it impacts quality and describes maturity has never been investigated. To establish a relationship  between trichome maturation and trichome head color changes (phenotype), we developed a novel automatic  trichome gland analysis pipeline using deep learning. We first collected a macro-photography dataset based on 4  commercially grown cannabis strains, namely ’Afghan Kush’, ’Green Death Bubba’, ’Pink Kush’, and ’White  Rhino’. Images were obtained in two modalities: conventional macroscopic light photography and macroscopic  UV induced fluorescence. We then implemented a pipeline where the clear-milky-brown heuristic was injected  into the algorithm to quantify trichome phenotype progression during the 8-week flowering period. A series of  clear, milky, and brown phenotype curves were recorded for each strain over the flowering period that were  validated as indicators of trichome maturation and corresponded to previously described parameters of trichome  development, such as trichome gland head diameter and stalk elongation. We also derived morphological metrics  describing trichome gland geometry from deep learning segmentation predictions that profiled trichome  maturation over the flowering period. We observed that mature and senescing trichomes displayed fluorescent  properties that were reflected in the clear, milky, and brown phenotypes. Our method was validated by two  experiments where factors affecting trichome quality and flower development were imposed and the effects were  then quantified using the deep learning pipeline. Our results indicate the feasibility of automated trichome  analysis as a method to evaluate the maturation of female flowers cultivated in a highly variable environment,  regardless of strain. These findings have broad applicability in a growing industry in which cannabis flower  quality is receiving increased circumspection for medicinal and recreational uses.  
legal framework for the cultivation and sale of recreational cannabis  
derived products [1]. Drug-producing cannabis strains are characterized  
Cannabis (Cannabis sativa L.) is valued for its medicinal use in every  continent except Antarctica, and many countries have established the  
by large female inflorescences (flowers) that bear a cluster of pistils  surrounded by bracts, which produce large numbers of glandular  
Abbreviations: ADT, Average distance to the nearest trichome; DAF, Days after flowering; CF, Clumping fraction; NN, Nearest neighbor; PAR, Photosynthetically  active radiation; CBD, cannabidiol; CBG, cannabigerol; CBN, cannabinol; THC, tetrahydrocannabinol; (CBD/CBG/CBN/THC)A, acid form of cannabinoid.  * Corresponding author.  
E-mail address: darrens@sfu.ca (D.B. Sutton).  
https://doi.org/10.1016/j.atech.2022.100111  
Received 25 May 2022; Received in revised form 13 August 2022; Accepted 22 August 2022 
Available online 28 August 2022 
2772-3755/© 2022 The Author(s). Published by Elsevier B.V. This is an open access article under the CC BY-NC-ND license (http://creativecommons.org/licenses/by nc-nd/4.0/). 
Smart Agricultural Technology 3 (2023) 100111 
D.B. Sutton et al. 
trichomes where cannabinoids and terpenes are synthesized [2].  Cannabis plants require approximately 8 weeks to mature prior to har vest, after which inflorescences are dried for sale in their natural form or  processed for value-added products (edibles, cosmetics, extracted oils).  In order to ensure optimal cannabis quality, it is imperative to identify  the stage at which the inflorescences are at the point of prime matura tion and hence potency. There are currently no scientifically based  methods to predict maturation and consequently harvests are performed  on a calendar basis i.e. when plants have attained 7–8 weeks of growth.  Methods to assess trichome maturation can lead to improvements in  quality assurance for the cannabis industry.  
In this work, we study cannabis trichome gland head phenotypes as  flowers mature and visual trichome changes occur, such as a progression  in color of the heads of trichomes from clear to milky to brown.  Although these phenotypes have been suggested as a visual heuristic for  harvest timing, little scientific work describes them during flower  development and trichome maturation. Previous work supports the idea  that browning of trichome heads is associated with quality degradation  in dried cannabis [3], but the shelf life of dried cannabis [4] and pro gressive trichome browning in storage makes extrapolation of results to  fresh cannabis tissue unpredictable. In order to understand the role of  trichome phenotypes during trichome maturation, it is necessary to  obtain measurements in situ during flower development.  
We describe an automatic computational method that was built to  extract trichome phenotype and morphology metrics during cannabis  flower development from macroscopic photographs. To reduce uncer tainty related to the chronology of observations, our method was  implemented in a commercial greenhouse such that the time delay be tween excision and photography was minimized. By implementing  recent advances in computer vision, we show our automatic method can  be used to define trichome maturation in multiple cannabis strains in  high throughput applications without repeated fine tuning.  
2. Related work  
2.1. Morphology of cannabis trichomes  
Trichomes are ubiquitous structures in the plant kingdom. Many  essential oil-bearing plants possess glandular trichomes that have  important commercial value [5]. Trichomes can also consist of plant  hairs lacking a gland, with a spike like appearance [6]. In hemp and  drug-producing cannabis plants, Hammond and Mahlberg [7] studied  trichome types using scanning electron microscopy (SEM) and described  3 types: bulbous, sessile, and capitate stalked. They subsequently  described the morphological development of capitate stalked trichomes,  observing stalk elongation and resin accumulation in the gland on top of  the secretory cells [8]. These contributions laid the groundwork for the  understanding of cannabinoid synthesis and storage in planta. Mahlberg  and Kim [9] further characterized the formation of the trichome gland  cuticle and proposed a working model of cannabinoid biosynthesis,  hypothesizing that tetrahydrocannabinolic acid (THCA) is formed  outside of plant cells in the storage cavity of the trichome gland [10].  Sirikantaramas et al. [11] confirmed this hypothesis by localizing the  enzymes necessary for cannabinoid synthesis to the storage cavity,  determining that cannabinoids are formed from a ring of secretory cells.  Livingston et al. [12] further characterized the development of cannabis  trichomes and observed that capitate stalked trichomes develop from  sessile type trichomes during the flowering period. The development of  trichomes from the sessile to cannabinoid rich capitate stalked type was  accompanied by a shift in autofluorescence of the gland contents from  green to blue.  
2.2. Trichome maturation  
The color transition of trichome heads from clear to milky to brown  is often used to manually approximate the stage of maturation, with  
milky representing the optimal state and brown indicating over maturation [10,13]. However, the relationship between trichome head  color and cannabis flower development has not been previously inves tigated. Previous work has shown a possible negative correlation be tween trichome head browning and cannabinoid content. Turner et al.  [14] were the first to show reduced cannabinoid content in senescent  (brown) capitate stalked glands, although statistical analysis was not  reported. Cannabis samples acquired from law enforcement and  manually assessed for trichome browning on a linear scale had a lower  THCA and increased cannabinolic acid (CBNA) content compared to  cannabis samples with clear or milky trichomes [3]. Reduced THC  content in senescent trichomes glands was also reported by Mahlberg  and Kim [10]. There is currently a lack of prior reports describing  trichome gland phenotype in relationship to cannabis flower develop ment in situ in cannabis.  
2.3. Automatic assessment of plant trichomes  
The microscopic nature of trichomes complicates manual observa tion, but recent advances in automatic methods to assess trichomes have  enabled increasingly powerful analyses. Glandular trichomes of tomato  were sorted by autofluorescent flow cytometry to separate young and  mature trichomes prior to transcriptome analysis of the gland contents  [15]. Failmezger et al. [16] estimated the 3D leaf surface of Arabidopsis  thaliana from 2D microscopy image stacks to characterize trichome  growth patterns. Mirnezami et al. [17] investigated image processing to  automatically count soybean trichomes from microscopy images. Deep  learning has also been applied to trichome analysis to estimate the  ’hairiness’ of cotton leaves as a metric of harvest readiness [18]. No  previous studies have assessed trichome maturation in cannabis using  these or similar approaches; thus, metrics that could be used to predict  when cannabis inflorescences have achieved a maturation stage indic 
ative of optimal cannabinoid content have not been established.  2.4. Contributions  
In this work, we document changes in trichome gland head pheno types over the flowering period and compare observations of the  trichome glands and the supporting bract tissue. We present a computer  vision pipeline to automatically segment and classify trichome gland  head phenotypes and validate the pipeline by experiments that induce  trichome degradation and alter trichome development. We also explore  novel fluorescent trichome gland head traits induced under UV irradi ation that were observed from whole glands, as opposed to previous  studies that explore fluorescence in a confocal manner [12,31]. We ac quired data using conventional optics such that our analysis was carried  out in situ and yielded same day results. We discuss our results in the  context of trichome development and cannabis flower maturation in  four cannabis strains (genotypes) and conclude with comments on the  feasibility of on-site imaging technology to automate quality aspects  during the cannabis cultivation process in the greenhouse. In the  following sections, we first describe plant materials, plant propagation,  and computational analysis (Sections 3 and 4 respectively), then present  results (Section 5) and conclude with the interpretation of results in the  discussion (Section 6).  
3. Materials and methods  
3.1. Plant materials  
This research was conducted in a Health Canada approved facility in  which the plants were grown in a commercial greenhouse using a hy droponic method of cultivation. There were four strains (genotypes)  studied that were grown during the winter months (October-April 2021,  strains Pink Kush ‘PK’, and White Rhino ‘WR’) or during the summer  months (May-September 2020, strains Afghan Kush ‘AK’, and Green  
2 
Smart Agricultural Technology 3 (2023) 100111 
D.B. Sutton et al. 
Death Bubba ‘GDB’). During the winter period, plants were provided  with supplementary lighting to achieve 1600 uEin/m2 of photosyn thetically active radiation (PAR) using sodium lamps emitting a wave length centered at 590 nm. During the summer period, supplementary  lighting was provided where needed on overcast days to achieve the  required PAR.  
All plants were initiated from cuttings taken from stock (mother)  plants of the four strains. The cuttings were dipped in rooting powder  (containing indoleacetic acid) and inserted into 2.5 cm rockwool cubes,  which were placed in trays in a propagation room under high relative  humidity (80%) and a temperature range of 23–27 ◦C. After 2 weeks,  when cuttings had rooted, they were placed into wells cut into 10 cm3  rockwool blocks and placed on a greenhouse bench for an additional 2  weeks to acclimatize and resume vegetative growth. Following this, they  were transferred into large cocofibre blocks, one plant per block, and  placed in a large flowering room where the photoperiod was adjusted to  12 hr lighting and 12 hr darkness to induce flowering. The water and  nutrient regimes were adjusted according to commercial growing re quirements to ensure adequate growth. The bags were arranged in rows,  with 2 rows parallel to each other, and spacing of 0.5 m between plants.  The plants were trained and supported by wire mesh netting that  allowed the developing inflorescences to grow upright. Pruning of  leaves and training of plants were conducted according to commercial  growing requirements.  
For experimental observations where inflorescences were photo graphed, each row of plants in the flowering room was divided into 10  zones, each containing up to 10 plants for observation such that no  inflorescence was excised from the same plant twice. The zones were  located in the center of the greenhouse to ensure uniform growing  conditions. Plants were not treated with any foliar sprays that could  influence trichome development. However, for one group of plants, a  spray of potassium bicarbonate (Milstop) was applied to cannabis  flowers of strain PK. Two plants each were sprayed with 100 ml of 2.5 g/  L Milstop at 5 weeks and 6 weeks after flowering using a hand-held  sprayer. Two control plants were misted with water. Images were  collected the following week (flowering week 7) from these plants. For  segmentation validation, plants from strain PK which were visually  stunted due to infection by a viroid disease were compared to healthy  plants. Images were collected from a stunted plant and two healthy  control plants at flowering week 7.  
3.2. Data collection  
Images of inflorescences were obtained from plants that were in the  3rd to 9th week of flowering. Images were collected weekly from the  onset of visible trichomes (week 3) to flower senescence (weeks 8 or 9,  depending on strain). The inflorescences selected for photography were  situated on the terminal apical branches of plants. Individual buds were  carefully removed using pruning shears and transported to a designated  room for image collection. The individual buds were separated into  segments representing apical, mid and bottom regions and bract tissue  samples were selected from both sides (Fig. 1). To capture the images of  trichomes, both visible lighting (range of 400–700 nm provide by  fluorescent lamps) and ultraviolet (centered at 350 nm) were used. The  latter was achieved by using Baader UV-pass filters as described in  Section 3.3. Each image was labelled according to location of the flower  sample, day of the flowering period, cannabis strain, and illumination  source. The dataset consisted of 840, 840, 720, and 720 images of strains  PK, WR, AK and GDB, respectively. The former two strains were  observed for an additional week to capture trichome browning. Image  resolution was 6240×4160.  
3.3. Image collection by photography  
All photographs were captured with a Canon 6D Mk. II DSLR Camera  (Canon, JP) fitted with a Canon MP-E 65 mm 1–5x macroscopic lens  
Fig. 1. Flower dissection for photography. Cannabis inflorescences were pho tographed by morphology: Bract tissue from Ⓐ both sides of the apical floret, Ⓑ  each of the opposite mid florets, and Ⓒ each of the opposite basal florets was  excised and photographed.  
(Fig. 2). Camera configuration was as follows: Lens magnification 3x  macro, f-number 16:14 conventional:fluorescent, color temperature  5500 K, sRGB color space, and exposure time of 1 s for both modalities.  The camera was mounted on a table with vibration damping grommets.  For UV excitation to photograph autofluorescence, a modified Vivitar  283 xenon flash (Vivitar, Santa Monica USA) had the stock Fresnel lens  replaced with a Baader UV-pass filter (Baader-Planetarium, Munich DE)  resulting in a flash centered at 350 nm and with a 60 nm bandwidth (320  – 380 nm). The single-photon fluorescence excitation wavelength of  ~350 nm used in this study is approximately equivalent to the two photo excitation wavelength of 720 nm used by Livingston et al. [12]  to characterize the fluorescence of sessile and capitate stalked trichomes  of hemp. Our approach uses simpler optics such that the camera pro 
totype can be dismantled and redeployed rapidly in situ, and the chosen  fluorescence excitation wavelength is outside of the spectral sensitivity  of most conventional image sensors. The Vivitar flash was synchronized  to the Canon DSLR camera via Elinchrom wireless flash trigger. All  images were captured with a color calibration swatch in view, and  fluorescent images were captured under conditions of complete  darkness.  
4. Machine learning methods  
4.1. Trichome gland segmentation  
Observations were made of trichome glands (Fig. 3) that formed on  the surfaces of bract tissues. Trichome glands were often partially  occluded or stuck to other trichomes, complicating the segmentation of  individual gland instances. Instance segmentation is a difficult problem  in computer vision because it requires the algorithm to separate the  foreground from the background in the image and individual compo 
nents (trichome glands) of the foreground scene. We used the deep  learning neural network ’DO-U-Net’ [19] designed for instance seg mentation of repeated convex shapes in 2D microscopy and aerial im ages, where a dual decoder U-Net architecture predicts a semantic mask  describing foreground membership (trichome glands), and the edges of  each trichome gland in the image (Fig. 4).  
3 
Smart Agricultural Technology 3 (2023) 100111 
D.B. Sutton et al. 
Fig. 2. The image collection prototype. Left: ① A modified Vivitar xenon flash, emitting a ~50 nm wide spectrum centered at 350 nm, ② Canon MP-E 65 mm macro  lens, ③ Canon 6D mk. II DSLR camera, ④ Manfrotto adjustable tripod, ⑤ photo plate with color calibration. Right: Images captured using light (top) and UV induced  fluorescence of bract tissues.  
Fig. 3. COLOR FIGURE Images of bract tissues from the dataset. Conventional (bottom row) and paired auto-fluorescent images (top row) of strain ’PK’ at (left to  right): 3, 5, 7 and 9 weeks of flowering. Scale bar represents 1 mm.  
DO-U-Net achieves instance segmentation by subtracting the pre dicted edges of trichome glands from the trichome gland mask, such that  individual glands are isolated. We apply the same loss function and  training parameters as outlined in the DO-U-Net method, only making  minor adjustments to edge and mask post processing such that adjacent  trichome glands are separated by single pixel width lines. We noted that  the original implementation of DO-U-Net tends to shrink the size of  detected trichome glands due to the edge subtraction operation, thus we  incorporated a custom post processing method using Voronoi cells to  mitigate this effect (Fig. A2, appendix). The DO-U-Net training and  testing data was a manually annotated subset of the data described in  Section 3.2, consisting of 156 (136:20 training:testing) images drawn  uniformly with respect to strain and observation time to construct a  balanced segmentation dataset (Fig. A1, appendix). We implemented  
DO-U-Net in PyTorch, using the built in ADAM optimizer. To ensure the  network generalized well to unseen data, we augmented the inputs at  training time using standard augmentation procedures: random hori zontal or vertical flipping, random rotation, and random color jitter.  Training time was approximately 2 h and was terminated after 100  epochs running on a Nvidia 1080ti GPU with 12 GB memory. The  network was trained on 512×512 pixel image patches randomly crop ped from input images. At inference, output mask patches and edge  patches were stitched back together to compute mask and edge pre dictions for whole bract tissue images, followed by application of our  post processing procedure. We refer the reader to the appendix where  supplementary figures describe the post processing steps in detail.  
4 
Smart Agricultural Technology 3 (2023) 100111 
D.B. Sutton et al. 
Fig. 4. COLOR FIGURE Segmentation pipeline. Input image patches ① are segmented into trichome glands ② using the artificial neural network DO-U-Net. Outputs  from different patches are stitched together ③ to segment trichome gland instances for each image. ④ Glands are then individually classified by phenotype using a k NN classifier (Fig. 5).  
4.2. Trichome phenotype classification  
A k-NN classifier was trained on manually labeled trichome glands  (Fig. 5). For each strain, 10 glands from the classes representing ’clear’,  ’milky’, and ’brown’ were delineated manually. Each segmented gland  was transformed from the sRGB to the CIELAB color space to disentangle  color from luminosity, reducing the effect of shadows on classifier ac 
curacy. Features were extracted by taking the mean of the L, a, and b  color channels, and the mean of a hessian (H) filter applied to the  chroma  
c = ̅̅̅̅̅̅̅̅̅̅̅̅̅̅̅ a2 + b2 
√ (1)  
The hessian filter is responsive to fine lines and details observed in  clear trichomes but obscured in milky trichomes. For inference, k was set  to 5, and the votes of training points were weighted by inverse distance.  The mean and standard deviation calculated from the training data were  applied to test data to standardize features at inference.  
4.3. Analysis of trichome morphology  
Changes in trichome morphology were assessed by computing met rics describing connected components in the post-processed semantic  segmentation maps predicted by the DO-U-Net. Connected components  are groups of contiguous foreground pixels representing a trichome head  gland. The average distance to the nearest trichome gland (ADT),  trichome gland density (trichome glands per mm2), trichome diameter  (in microns), trichome clumping fraction (CF), and roundness were  computed from the data for each strain and phenotype where phenotype  specific metrics were meaningful. The ADT was calculated as the mean  of the distance transform describing the average distance to the nearest  trichome gland over the area of the bract tissue. Trichome density was  computed by counting the number of trichome instances and dividing by  the pixel area of the bract tissue, then scaling by the spatial pixel size of 2  µm. Trichome diameter was computed as the diameter of a disk with the  
equivalent pixel area to each trichome gland instance. CF was calculated  by comparing the number of trichome gland instances detected in each  bract image when connectivity was defined as 4 pixel or 8 pixel. In other  words, trichome gland instances that were delineated by a single pixel  line after post processing were deemed separate by 4-connectivity but  connected by 8-connectivity. A comparison of the two trichome gland  counts indicated how many trichomes were clumped together in the  image. The CF is expressed as:  
(N4 − N8) 
N4(2)  
for each image where N is the number of trichome instances detected by  the connectivity denoted by the subscript (Fig. A3, Appendix). Round ness was calculated by the circularity metric  
4π⋅ Agland 
Perimeter2gland. (3)  4.4. Statistical analysis  
Data were subjected to independent two-sided T-tests for signifi cance in validation experiments (Milstop and disease induced stunting)  at p < 0.05. For trichome head diameter results and the morphological  metrics ADT, density, CF, and roundness, the Seaborn plotting library  visualized means, standard deviations of the mean, and first or second  order regression lines. For regression lines, the 95% confidence intervals  of trend lines were visualized to assess whether the confidence intervals  of the trend lines overlapped (Figs. 8 and 15). Confidence intervals that  did not overlap were interpreted as being trendlines of significantly  different groups.  
4.5. Validation  
We validated our algorithm using a hybrid approach, combining  
Fig. 5. COLOR FIGURE k-NN classifier. Left: Ten clear, milky, and brown trichomes (gland columns L-3 respectively) used to train the k-NN classifier for strain GDB,  and the resulting t-SNE clustering of training features. Right: At inference, the k-NN classifier Ⓐ extracts features and Ⓑ predicts the probability of each gland  instance belonging to class clear, milky, brown. A k-NN classifier is constructed for each strain, here we only show the classifier for GDB for brevity.  
5 
Smart Agricultural Technology 3 (2023) 100111 
D.B. Sutton et al. 
manual assessment of gland segmentation and classification accuracy,  and experimental assessment of algorithm predictions compared to prior  biological knowledge of the cannabis flower. Pixelwise metrics,  although useful for determining performance discrepancies between  automatic methods, have less meaning when assessing the performance  of an algorithm in the context of the biological domain being investi 
gated. Therefore, we turn to the recommendation of Sbalzarini [20] who  argued that the most pragmatic method of validating a bio-imaging al gorithm is to test predictions against prior knowledge from the same  domain as the research question. We conducted two validation experi ments, the detection of stunted trichome maturation as predicted by  trichome diameter when flowers were subjected to viroid disease stress,  and the detection of trichome browning when flowers were sprayed with  an alkaline chemical treatment (Section 3.1).  
5. Results  
We manually inspected the accuracy of the predicted segmentation  masks on a withheld test set of bract images. We observed a low false  positive rate and satisfactory instance segmentation of whole trichome  gland heads (Fig. 6). Glands that detached from stalks and released their  contents to form amorphous blobs of resin were not detected. The ac 
curacy of the k-NN classifier was verified via manual assessment of bract  tissue images at different flowering time points to confirm trichome  head phenotype predictions correctly described trichome gland devel opment from transparent sessile and pre-stalked capitate (clear) to  capitate stalked abundance (milky) prior to harvest time until trichome  gland senescence (brown).  
An examination of the clear-milky-brown results of all four cannabis  strains over flowering time showed that in general, trichome browning  was absent until approximately 50 days after flowering (daf) (Fig. 7).  There was a rapid increase in the prevalence of brown trichome heads at  65–75 days of the flowering period. By comparison, the clear trichome  heads were most abundant at day 25 of the flowering period, and began  to steadily decline up to the end of the experiment (harvest time, day  65–75 of the flowering period, depending on the strain). The trichome  heads displaying the milky phenotype began to gradually increase in  prevalence in each strain, with a peak at day 55 in PK, at day 50 in  
strains AK and GDB, and a maximum at day 70 in WR. A significant  difference in trichome gland head phenotype was not observed when  assessed by dissection morphology as outlined in Fig. 3.  
The changes in trichome head diameter over the flowering period are  shown in Fig. 8. For all strains, there was a gradual increase in diameter  up to around day 50, coinciding with the emergence of the brown  phenotype. Gland head diameters steadily decreased following the onset  of trichome browning. The head diameters of brown trichomes were  consistently smaller for all four strains, ranging in size from 75 to 85 μm  (strains PK and WR) and 85–95 μm (strains AK and GDB). In general,  diameters of milky trichome heads were greater than clear (strains AK  and GDB) or the same (strains PK and WR), with peak sizes of 105–110  μm (AK, GDB) and 95–100 μm (PK, WR). The average trichome head  diameter of clear trichomes peaked at approximately the same size as  the milky phenotype for strains PK and WR and at a diameter of 100 μm  for strains AK and GDB. The ADT increased for strains PK, AK, and GDB,  related to an expansion of bract tissue during the flowering period,  whereas WR showed a slight reduction in ADT that corresponded to a  delayed milky phenotype peak and stunted growth relative to other  strains in the experiment (Fig. 9). In general, trichome gland heads  diverged from bract venation to form stripe like groupings of trichome  heads aligned axially with the supporting bract tissue during the mid to  later stages of flower maturity. This stripe pattern was caused by stalk  elongation normal to the concave surface of the abaxial bract tissue,  exposing venation and surrounding non glandular tissue to direct sun light. When trichome gland prevalence was expressed as density (tri chomes per mm2, Fig. 10), there was a steady decline over time in the  flowering period for all four strains, with PK and WR sustaining a higher  density at harvest of 25–30 trichomes/mm2 compared to AK and GDB at  20–25 trichomes/mm2, corresponding to non-glandular bract tissue  expansion, increased stalk length, and trichome gland striping. The  reduction in estimated density of trichomes could also be explained by  the decreasing trend of trichomes that clumped together (Fig. 11) in  strains AK and GDB, whereas strains PK and WR displayed a flat and  increasing trend in CF over the flowering period and retained higher  trichome densities. Importantly, PK, AK and GDB displayed higher  average CF (i.e., a higher clumping curve offset) over the flowering  period compared WR, corresponding to the arrested trichome  
Fig. 6. COLOR FIGURE Segmented and classified trichomes glands. Top to bottom: immature, mature and senescent bract tissue of strain PK. Glands are circled  according to their classification: clear (blue), milky (green), or brown (red). Zoomed in patches show detailed segmentation and classification results.  
6 
Smart Agricultural Technology 3 (2023) 100111 
D.B. Sutton et al. 
Fig. 7. COLOR FIGURE Clear, milky, brown phenotype probability. Local regression trend lines (dotted) of clear (blue), milky (green) and brown (red) phenotype  probability. Points are means of the observed trichomes, with error bars showing the standard deviation of the mean. Results should be interpreted as the probability  of a randomly chosen trichome, observed at a time during the flowering period, belonging to a phenotype class clear, milky, or brown. Local regression lines are for  visualizing the phenotype trend over the flowering period.  
Fig. 8. . COLOR FIGURE Trichome diameter. For each phenotype observed over the flowering period, trichome gland head diameters were computed. Points are the  mean of all trichomes observed and error bars correspond to the standard deviation of the mean. Second order regression lines fitted to each phenotype display 95%  confidence intervals as transparent bands.  
Fig. 9. Average distance to the nearest trichome (ADT). For each photographed bract image, the average distance to the nearest trichome was computed. Points are  the mean of all bract tissue samples observed, with error bars representing the standard deviation of the mean. Linear regression lines display 95% confidence  intervals as transparent bands.  
Fig. 10. Trichome density. For each photographed bract image, trichome density was computed as the number of trichome gland heads per square millimeter. Points  are the mean of all bract tissue samples observed at the specified flowering time, with error bars representing the standard deviation of the mean. Second order  regression lines display 95% confidence intervals as transparent bands.  
7 
Smart Agricultural Technology 3 (2023) 100111 
D.B. Sutton et al. 
Fig. 11. Clumping fraction (CF). For each photographed bract image, the clumping fraction was computed as the relative difference in detected trichome glands  using different connectivity criteria (Eq. (2)) observed over the flowering period. Points are the mean of all bract tissue samples observed at the specified flowering  time, with error bars representing the standard deviation of the mean. Linear regression lines display 95% confidence intervals as transparent bands.  
development that can be visualized by inspecting stalk development of  
WR trichomes (Fig. 12). The clumping of trichome heads could be  
readily visualized when examined under a scanning electron microscope  
(Fig. 13). Trichome roundness as assessed by the circularity metric  
reduced steadily for all four strains over the flowering period, related to  
the degradation of trichome gland heads and changes in camera view  
due to trichome stalks elongating in plane and turning trichome heads to  
side with respect to the camera (Fig. 14).  
When the UV induced autofluorescence was examined over the time  
of the flowering period, there was a peak in the fluorescence color angle  
as parameterized by the CIELAB a-b color space at approximately 40  
days of the flowering period followed by a decline (red shift) in all four  
strains observed. The decline was gradual in trichome heads showing a  
clear or milky phenotype and much more pronounced in the brown  
trichome heads (Fig. 15), presumably due to differences in chemical  
composition of the fluorescing substance in brown trichomes compared  
to gland heads of the clear or milky phenotype. Brown trichomes had a  
more negative fluorescence color angle than clear or milky trichomes  
from onset of trichome browning until experiment end for all strains,  
fluorescing green-blue (Fig. 16). In general, fluorescence intensity  
increased over the flowering period (Fig. 17), indicating an accumula tion of the fluorescent substance, likely cannabinoids.  The application of potassium bicarbonate (Milstop) to cannabis  flowers increased trichome browning compared to the water treated  control (Fig. 18) and red shifted the fluorescence color angle compared  to the control (Fig. 19, top left), due to a higher number of brown tri chomes observed in the treated tissue. Milstop application also reduced  trichome density (Fig. 19, top right and Fig. 20) and clumping (Fig. 19,  bottom right) due to degradation of the trichome head cuticle, but did  not significantly affect the average distance between trichomes (Fig. 19,  bottom left), as this metric is dominated by bract tissue expansion that  was not affected by Milstop. Visually stunted plants that displayed signs  of viroid disease (Fig. 21) due to arrested trichome development by  
Fig. 13. Scanning electron microscopy image of clumped trichomes. Senescent  flower tissue was imaged by cryogenic SEM to observe resin leakage from  glands and gland clumping. Scale bar (lower right) represents 50 μm.  
presumed disease pressure, when assessed by our automatic pipeline  showed significantly smaller trichome size, with the mode of the stunted  group occurring at a diameter of approximately 80 μm whereas healthy  control plants possessed trichomes of approximately 100 μm diameter  (Fig. 22, left). The density between groups was not significantly different  (Fig. 22, right), which indicated that the visual manifestation of disease  induced stunting was mainly observed as arrested trichome develop 
ment, a lack of capitate-stalked trichome type, and smaller flower mass.  
Fig. 12. Trichome stalk length. Left to right: Image patches of PK, WR, AK, and GDB flower tissue at harvest (flowering day 50). Strain WR displayed stunted  glandular trichome stalk development compared to other strains.  
8 
Smart Agricultural Technology 3 (2023) 100111 
D.B. Sutton et al. 
Fig. 14. Trichome gland head roundness. For each bract image, the circularity was computed as shown in Eq. (3). Points are the mean of all bract tissue samples  observed at the specified flowering time, with error bars representing the standard deviation of the mean. Linear regression lines display 95% confidence intervals as  transparent bands.  
Fig. 15. COLOR FIGURE Trichome gland head fluorescence. The CIELAB color angle describing fluorescence spectra of for all trichome gland heads observed over  the flowering period. Points represent the mean of all trichomes observed at the specified flowering time, with standard error bars representing the standard de viation of the mean. Second order regression lines fitted to each phenotype display 95% confidence intervals as transparent bands.  
Fig. 16. COLOR FIGURE Trichome gland heads and corresponding fluorescence. Qualitative display of visual phenotype and corresponding trichome fluorescence of  strain GDB. Rows, from top: clear trichome heads, milky trichome heads, brown trichome heads, fluorescing clear trichome heads, fluorescing milky trichome heads,  fluorescing brown trichome heads. Note the red shift of brown trichome fluorescence.  
6. Discussion  
Cannabis trichomes display visual cues of maturation during flower  development, but their small size obscures important aspects of their  morphology and appearance to the unaided eye. Unlike other crops  where visual observations can be relied upon to predict maturity and  optimal harvest time, e.g., changes in fruit color and size, cannabis tri 
chomes display maturity indicators at a microscopic scale, complicating  visual inspection. In this case, obtaining visual patterns of trichome  maturity requires a systematic approach that integrates recent advances  in automatic computer vision supported by biological knowledge of the  
cannabis plant. Prior to this study, there was no description of cannabis  trichome maturation during flower development in situ, where data was  collected as on-site images and results could translate directly to the  cultivation process in the greenhouse. To achieve this, we reasoned that  the visual trichome gland head phenotypes described as clear, milky,  and brown, that previously were used as unconfirmed descriptors of  trichome gland maturation [21], could be used to characterize trichome  maturity when implemented as discriminating features in an automatic,  data driven analysis of cannabis flower images. We used our automatic  method to observe the evolution of visual trichome phenotypes and  metrics describing changes in trichome morphology over the flowering  
9 
Smart Agricultural Technology 3 (2023) 100111 
D.B. Sutton et al. 
Fig. 17. COLOR FIGURE Trichome fluorescence luminosity. The L value from the CIELAB color space of fluorescing trichomes, describing fluorescent intensity but  not spectrum. All phenotypes clear (blue), milky (green), and brown (red) show increasing average intensity with time, indicating an accumulation of the fluorescent  substance. Local regression lines show qualitative trend over the flowering period.  
Fig. 18. COLOR FIGURE Milstop affects trichome gland head phenotype. Phenotype probability of water control (w) and Milstop treated (m) trichomes. Milstop  treatment significantly increased trichome browning and reduced milkyness at p < 0.05, denoted by asterisks over the bars. The clear phenotype probability was not  significantly different between groups.  
Fig. 19. Milstop application affects trichome morphology. Clockwise from top left: Fluorescence CIELAB color angle (greener color angles are more negative) of  control and Milstop treated trichomes, distribution means are significantly different at p < 0.01, Milstop significantly reduces trichome density at p < 0.05, Milstop  significantly reduces clumping factor at p < 0.05, Milstop does not significantly affect the distance to the nearest trichome.  
period from developing flowers. We then compared these results to  other morphological indicators of trichome maturity, specifically  trichome gland head diameter and trichome stalk length. Our results  
show that (1) trichome maturity can be described by trichome  morphology metrics; (2) the temporal characteristics of the clear, milky,  and brown phenotype curves validate their role as visual indicators of  
10 
Smart Agricultural Technology 3 (2023) 100111 
D.B. Sutton et al. 
Fig. 20. Patches of DO-U-Net trichome gland segmentation. 100 patches from water treated control and Milstop treated trichomes showing the effects of the  treatment on density and the CF metric. Scale bars represent 2 mm.  
Fig. 21. Healthy (left) and viroid diseased (right) cannabis flowers of strain Pink Kush showing stunted development in the latter.  
Fig. 22. Flower stunting affected trichome development. Left: Stunting from visually confirmed viroid disease reduces trichome diameter significantly at p < 0.0001.  Healthy trichomes have a mode of 100 μm, compared to trichomes from stunted bract tissue with a mode diameter of approximately 80 μm, (Right) Stunting does not  affect trichome density due to reduced flower tissue growth of the stunted group.  
11 
Smart Agricultural Technology 3 (2023) 100111 
D.B. Sutton et al. 
trichome maturity; (3) the clear, milky, and brown phenotypes can be  differentiated by trichome gland head fluorescence, further validating  their role as phenotypic markers of trichome maturity; and (4) changes  in trichome gland head phenotypes and morphological metrics induced  by chemical treatment and plant disease stress can be detected, thus  validating our automatic method.  
6.1. Morphology metrics describe trichome maturation  
The biological processes that are associated with resin accumulation  in cannabis strains have recently been explored by proteomic, genetic,  and plant metabolic studies to understand cannabinoid synthesis and  trichome maturation during cannabis flower development [21–23]. Our  morphological characterization of trichome development concurs with  these changes that describe cannabis flower development and trichome  maturation at the cellular level. We describe factors such as temporal  changes in distance to the nearest trichome, density, clumping fraction,  and head roundness in concordance with stalk elongation, flower  development, and trichome maturation.  
6.1.1. ADT  
The distance to the nearest trichome (ADT) metric described flower  tissue expansion—a positive slope corresponded to healthy flower  growth where bract tissue expanded at a faster rate compared to  trichome diameter and presumably energy production (through photo 
synthesis) increased during the flowering period to support trichome  maturation. Strains that did not show a positive increase in ADT (e.g.,  WR) subsequently displayed stunted trichome development i.e., small  gland head diameter, arrested stalk elongation, and small flower size at  harvest. This impact on WR is presumed to have been due to additional  stress imposed on the plant through hermaphroditism (self-pollination),  which arrests flower development and resin accumulation by diverting  energy to pollen and subsequent seed formation [24,25]. The reliance of  trichome maturation on flower development was reported by Conneely  et al. [23], who exhaustively studied the protein expression of trichome  head glands, stalks, and supporting bract flower tissue. They determined  that bract tissue is important for starch synthesis through photosynthesis  to fuel trichome development and cannabinoid biosynthesis during the  flowering period, when the vegetative fan leaves begin to senesce.  
6.1.2. CF  
The clumping fraction (CF) morphology metric described a rela tionship between trichome diameter and bract tissue expansion. We note  the symmetric relationship between the ADT and CF curves for all  strains in this study, indicating these metrics are describing similar  biological phenomena. Strains AK and GDB had large trichome di ameters at the start of the experiment such that trichomes impinged  against each other on underdeveloped bract tissue, and therefore had an  increased CF compared to strains PK and WR. The CF for AK and GDB  then decreased due to bract tissue expansion, indicative of healthy  flower development over the flowering period. Conversely, the CF of WR  increased over the flower period, starting from low initial CF caused by  small sized trichomes on incipient bract tissue at the start of the  experiment that did not impinge against each other, followed by a CF  increase over the harvest period, indicative of trichome gland heads  expanding at a faster rate than the underlying bract tissue.  
6.1.3. Density  
Lower trichome head density (trichome gland heads per mm2 of  bract tissue) at harvest, caused by bract tissue expansion during flower  development, co-occurred visually with trichome stalk elongation, cor responding to previous studies that found the secondary metabolism of  trichome gland heads required support from enlarged flower tissue [22,  23] and photosynthesizing stalks. In this study, we sampled the apical  inflorescences, which are some of the largest of the plant. Recent work  on the morphology of cannabis inflorescences found inflorescence width  
to vary by more than a factor of 2 between the smallest and largest in florescences at harvest [26], indicating that flower growth probably  offsets the drop in trichome gland density we observed over the flow ering period. The reduction in density we observed across all strains in  the experiment has also been reported by manual counting of trichome  gland heads observed under SEM modality, showing a decreasing den sity trend [27]. Interestingly, WR maintained the highest density over  the flowering period, while AK and GDB achieved the lowest gland head  density, indicating trichome glands per unit area of bract tissue  decreased with flower development and trichome maturation. Another  factor that could affect density measurements but not explored in this  work is the detachment of trichome head glands from supporting stalks.  This process presumably occurs when flower development reaches  maturity, and especially at senescence.  
6.1.4. Roundness  
All strains showed a decrease in gland head circularity, as computed  by Eq. (3). We attribute this to the degradation of the trichome head  resulting in various shapes of trichome heads. WR showed the smallest  decrease in circularity over the flowering period compared to other  strains, indicating limited gland degradation that can also be observed  by a lack of observed trichome browning.  
6.1.5. Trichome morphology to profile trichome maturation  Strain PK displayed a profile of morphological metrics that was in  between the extremes of the upper bound morphology metric profiles of  AK and GDB, both of which displayed elongated trichome stalks at  harvest time, and the lower bound profile of WR, where trichome stalk  elongation did not occur and trichome gland head diameter was small.  The trichome gland head diameter and stalk length observed in PK was  also between the upper bound of AK and GDB, and lower bound of WR,  indicating that our morphology metrics form a 4-dimensional descrip tion of trichome maturity. Furthermore, our morphological metrics infer  a close relationship between trichome maturation and the development  of the supporting flower, suggesting that trichome maturation only oc curs if the supporting bract tissue expands. Bract tissue growth could be  predicted by extrapolating the slope of observed morphology metrics,  thus yielding a simple model to approximate flower maturation from  image data.  
6.2. Trichome phenotypes have distinct temporal curve characteristics  
The trichome phenotypes clear, milky, and brown have little prior  scientific evidence to substantiate their use as visual indicators of  glandular trichome maturation, and subsequently their utility during the  flower development process has not been adequately elucidated.  Mahlberg and Kim reported that capitate-stalked trichome glands, when  viewed under a stereomicroscope, were translucent during intense resin  accumulation [10], and demonstrated that brown trichomes have a  lower THC content. The reduced THC content of brown trichomes has  also been observed in dried flowers [3].  
6.2.1. Trichome phenotypes generalize to cannabis strains  Our results show a striking relationship of each phenotype during  flower development. Strains AK, GDB, and PK that displayed stalk  elongation and increased trichome diameter at harvest had a distinct  peak in the occurrence of the milky phenotype over the flowering  period, whereas this peak was absent for strain WR. All strains showed  the clear phenotype dominating at the start of the experiment and fol lowed a common trichome phenotype transition regardless of strain.  Trichome phenotype response was affected by stress caused from  changes in the growing environment, and the clear, milky, brown phe notypes appeared to be strain agnostic indicators of flower development.  
6.2.2. Clear to milky transition  
The clear to milky phenotype transition could be due to a mixing of  
12 
Smart Agricultural Technology 3 (2023) 100111 
D.B. Sutton et al. 
immiscible molecules in the trichome gland head during resin accu mulation [9,10]. As cannabinoid precursors are secreted into the  trichome gland head cavity by a disk of secretory cells at the base of the  gland, superior to the stipe cells [12,28], vesicles distribute cuticle  building molecules that enable the trichome head to continuously  expand [10,29]. The migration of waxy cuticle precursors in vesicles  into the gland head would result in an opaque gland head appearance  due to the varying refractive indices of hydrophilic and hydrophobic  substances obscuring the passage of light; thus, the visual transition  from clear to milky likely indicates changes in amounts of  cuticle-forming precursors and changes in the internal contents of the  head [12,30]. Mahlberg and Kim [9] and Livingston et al. [30] showed  that the waxy cuticle of mature stalked trichomes is significantly thicker  compared to the sessile non-stalked type, which could also increase the  opacity of the trichome head gland when viewed externally.  
6.2.3. Trichome phenotype and flower maturity  
There was a defined peak in the milky phenotype that occurred when  trichome development was accompanied by stalk elongation to form the  capitate-stalked trichomes [12]. In instances where a milky phenotype  peak was not observed (e.g., in WR), stalk elongation was reduced, mean  trichome diameter was smaller, as seen in non-drug producing tri 
chomes of hemp [41], and trichome morphology as described by our  metric profiles deviated relative to other strains in the experiment. This  indicates that the milky phenotype curve is a descriptor of trichome  maturation and successful transition from the sessile to capitate-stalked  type. Trichome browning was evident in increasing abundance only at  the end of the experiment, and thus reflected trichome senescence as  shown in previous work [3,10].  
6.3. Visual trichome phenotypes are differentiated by trichome  fluorescence  
6.3.1. Qualitative description of gland fluorescence  
The clear, milky and brown phenotypes were distinguished by  trichome gland head fluorescence when observed under UV light. Brown  trichome heads showed red shifted fluorescence compared to clear and  milky trichome heads for all strains in the experiment. The fluorescence  within clear, and to a lesser extent milky, trichome gland heads  appeared to be localized to cell structures within the gland. Fluorescence  intensity formed ring like shapes that appeared to be localized to  secretory cells in the trichome gland head, where cannabinoids and  cannabinoid precursors such as cannabigerolic acid (CBGA) are pro duced [31]. Weaker blue fluorescence was also observed in the heads of  clear trichomes, increasing in intensity in milky trichomes. The ring like  shapes in trichome heads were less defined towards the end of the  flowering period, when fluorescence was uniform throughout the  trichome head. This was followed by red shift in head fluorescence  associated with trichome browning. Weak fluorescence from  non-glandular flower tissue was observed in the red channel only, cor responding to chlorophyll content.  
6.3.2. Causation of fluorescence in trichomes of cannabis  The reduction in visually localized fluorescence within trichome  heads at maturity and senescence suggests reduced accumulation of  cannabinoids or the breakdown of existing cannabinoids near secretory  cells. When we analysed trichome head fluorescence by raw RGB  channel values instead of the CIELAB color space, the green channel  intensity increased linearly during flower maturation for all strains,  whereas the blue channel plateaued (data not shown) near the harvest  window, suggesting accumulation of a blue-green fluorescent substance  in the trichome gland head during maturation. Conversely, the blue green channel fluorescence of non-glandular flower tissue was insig nificant over the flowering period, indicating the source of blue-green  fluorescence in trichome heads was local secondary metabolites and  not inherent to the plant cuticle. Livingston et al. [12] first showed that  
fluorescence from the resinous contents in floral trichome heads of hemp  shifted from green when sessile to blue when capitate-stalked. Our re sults confirm these observations and extend the observation period to  senescence. Cannabinoids fluoresce blue, even after degradation to  CBNA [32], thus red shifted fluorescence upon trichome senescence  suggests the accumulation of a non-cannabinoid fluorophore in the  gland and cuticle of the trichome head. Trichome head cuticle pro gressively thickens during trichome maturation, supported by the  deposition of cuticle that has migrated through the trichome head  embedded in wall matrix with other lipophilic compounds i.e. terpe noids and flavonoids [9,30]. Flavonoids have been detected by green  fluorescence in glandular trichomes of multiple plant species [35,36].  Flavonoids are known to protect plant tissues from UV induced damage  [37] and are commonly found in the cuticle [38]. In tomato fruit cuti cles, flavonoids play a mechanical role by increasing the Young’s  modulus and elastic phase during fruit ripening [39,40]. Therefore,  flavonoids appear to play a role in plant cuticle rigidity, resistance to  deformation, and elasticity. When Bergau et al. [36] observed fluores cence in glandular trichomes of a mutant tomato strain, in which  flavonoid biosynthesis was suppressed, green autofluorescence of the  cuticle was diminished compared to the wild type strain. Taken  together, our results in combination with observations from other re searchers suggests that trichome head fluorescence in cannabis pro gresses from green when sessile, to blue fluorescence near the secretory  cells and in the trichome gland head due to accumulation of cannabi noids during development [12,32], to blue-green fluorescence due to a  non-cannabinoid fluorophore e.g. flavonoids red shifting the fluores cence observed from whole trichome heads during senescence. Further  work analyzing the fluorescence emission from maturing and senescent  glands using confocal methods, such that cuticle and resin fluorescence  are delineated, is necessary to elucidate the causes of trichome gland  head fluorescence in more detail.  
6.4. Phenotypes and morphology metrics can be manipulated by chemical  treatment and stress  
6.4.1. Milstop application  
When basic potassium bicarbonate (pH 8.0) was applied to cannabis  flowers, trichome density and clumping were significantly reduced,  reflecting a degradative effect of Milstop on the trichome gland head  cuticle. The distance to the nearest trichome was not significantly  affected as Milstop applications did not stunt floral bract tissue expan 
sion. Milstop sprays likely induced oxidative stress on the surface of the  trichome head cuticle, compromising the gland structure. This was re flected by an increase in the brown phenotype, reduced appearance of  the milky phenotype, and the emergence of a red shifted fluorescent  mode from Milstop treated trichome heads. Previous work has shown  flavonoids to fluoresce green when exposed to a basic solution [33, 34],  with fluorescence intensity increasing with the pH of the applied solu tion. When fluorescence data was analysed by raw RGB values instead of  the CIELAB color space (data not shown), Milstop application signifi cantly increased the green channel fluorescence of trichome glands  compared to the water treated control, suggesting the presence of a  green fluorescent substance that was responsive to pH.  
6.4.2. Presumptive viroid disease stress  
When cannabis flowers showed signs of stunting due to presumptive  virus disease stress, trichome stalk elongation was reduced and tri chomes remained sessile, and their diameter as computed by our auto matic method was approximately 20 μm smaller than trichomes of  healthy flowers, with a mode stunted diameter of approximately 80 μm.  Small and Naraine [41] characterized trichome head gland diameter in  drug-producing cannabis flowers as well as in hemp (non-psychoactive,  non-drug producing) flowers, and showed that the former have larger  trichome head diameters at harvest compared to the latter. The average  diameter of trichomes heads of hemp in their work was 80 μm, similar to  
13 
Smart Agricultural Technology 3 (2023) 100111 
D.B. Sutton et al. 
the predicted trichome head diameter of stunted plants with arrested  flower development in this study. Livingston et al. [12] described a  developmental and morphological link between sessile and capitate  stalked trichomes, reporting that numbers of secretory cells increased  together with stalk elongation during the transition from non-stalked  sessile trichomes to capitate stalked trichomes. Our results suggest  that stunted trichome flower maturation induced by disease stress did  not achieve the mature capitate stalked trichome type found on healthy  bract tissues. Since trichome stalk elongation is correlated with accu mulation of cannabinoids such as THC in the trichome heads, this has  important commercial implications. Our automated approach can  potentially distinguish trichomes on plants that are subjected to various  forms of stress which may influence the accumulation of cannabinoids.  
7. Conclusion  
The growing environment surrounding cannabis plants can impose  various forms of stress, influencing the accumulation of cannabinoids.  Cannabis flower development progresses over a 7–8-week period during  which glandular trichomes achieve maturation and presumably contain  the highest cannabinoid content. Measurements of cannabinoids (THC  and CBD in particular) and terpenes are conducted following harvest by  commercial testing labs, thus these analyses are not informative during  the flowering period. One challenge in the cultivation process is estab lishing the optimal time to harvest, which can vary according to the  cannabis strain and growing conditions. This unpredictability can be  reduced by the automated trichome analysis approach we describe here  that establishes strain agnostic phenotypes associated with flower  development. By combining conventional optics with recent advance 
ments in computer vision, we were able to analyze the details provided  in macroscopic photography using the high throughput, data-driven  processing capabilities of machine learning, such that the morpholog ical features of developing trichomes could be recorded during cannabis  flower maturation for multiple strains in situ. The observed relationship  between trichome gland head diameter and morphological metrics in dicates the feasibility of automatic quality assurance software that can  determine how flower maturation is proceeding and if strain specific  potential may be attained. Parameterization of flower maturation and  trichome development by metrics describing trichome morphology  would form a decision space where a classifier or other data driven  model could estimate if cannabis flowers are ready for harvest, are  subjected to stress or disease, or preferable compared to other candidate  strains. The limitations of our work are the fixed bird’s eye viewpoint of  our observations, limiting detection of occluded trichome glands un derneath elongated stalks or resident in folds of bract tissue. The ob servations made are also limited to a small portion of the bracts on a  large inflorescence, although the lack of significant differences in  phenotype development at different points within the inflorescence, as  outline in Fig. 1, implies that sparse sampling is feasible. Further inte gration of computer science advances to extract supplementary infor mation describing bract tissue geometry would refine the automatic  trichome analysis pipeline. Additionally, we designed a classifier around  the clear-milky-brown phenotype as this was the traditional visual  description of cannabis glandular trichome maturation, but we have not  investigated whether these three classes are optimal for fine grained  classification of glandular trichomes. Further work employing purely  data driven methods to cluster trichome visual features could be  explored to discover additional classes, potentially revealing novel vi sual descriptors of glandular trichome maturation and flower develop ment in cannabis.  
Funding  
This work was supported by the Natural Sciences and Engineering  Research Council of Canada Alliance grant, jointly with Pure SunFarms,  Delta, BC, through a university-industry collaborative project awarded  
to Simon Fraser University.  
CRediT authorship contribution statement  
D.B. Sutton: Conceptualization, Formal analysis, Data curation,  Visualization, Writing – original draft, Writing – review & editing. Z.K.  Punja: Conceptualization, Formal analysis, Writing – original draft,  Writing – review & editing, Supervision, Funding acquisition. G.  Hamarneh: Conceptualization, Formal analysis, Writing – original  draft, Writing – review & editing, Supervision, Funding acquisition.  
Declaration of Competing Interest  
The authors declare that they have no known competing financial  interests or personal relationships that could have appeared to influence  the work reported in this paper.  
Acknowledgements  
We thank Alex Cheung, Devin Melnyk, Rob Baldwin, Liam Buirs, and  Sam Lung (Pure SunFarms Ltd.) for their assistance with data collection,  conducting experiments, and plant propagation.  
Supplementary materials  
Supplementary material associated with this article can be found, in  the online version, at doi:10.1016/j.atech.2022.100111.  
References  
[1] T. Seddon, W. Floodgate, W. Cham, Regulating Cannabis: A global Review and  Future Directions, Springer International Publishing AG, 2020.  
[2] C.M. Andre, J.F. Hausman, G. Guerriero, Cannabis sativa: the plant of the thousand  and one molecules, Front. Plant Sci. 7 (19) (2016), https://doi.org/10.3389/  fpls.2016.00019.  
[3] David JP Potter, The propagation, Characterisation and Optimisation of Cannabis  sativa L. As a Phytopharmaceutical, Kings College, University of London, 2009. PhD  thesis.  
[4] J. Meija, G. McRae, C.O. Miles, J.E. Melanson, Thermal stability of cannabinoids in  dried cannabis: a kinetic study, Anal. Bioanal. Chem. 414 (2022) 349–359.  [5] B. Dell, A.J. McComb, Plant resins – their formation, secretion and possible  functions, Adv. Bot. Res. 6 (1979) 277–316, https://doi.org/10.1016/S0065-2296  (08)60332-8.  
[6] D.A. Levin, The role of trichomes in plant defense, Q. Rev. Biol. 48 (1) (1973) 3–15.  [7] C.T. Hammond, P.G. Mahlberg, Morphology of glandular hairs of Cannabis sativa  from scanning electron microscopy, Am. J. Bot. 60 (6) (1973) 524–528, https://  doi.org/10.2307/2441375.  
[8] C.T. Hammond, P.G. Mahlberg, Morphogenesis of capitate glandular hairs of  Cannabis sativa, Am. J. Bot. 64 (8) (1977) 1023–1031, https://doi.org/10.2307/  2442258.  
[9] P.G. Mahlberg, E.-.S. Kim, Cuticle development on glandular trichomes of Cannabis  sativa (Cannabaceae), Am. J. Bot. 78 (8) (1991) 1113–1122, https://doi.org/  10.1002/j.1537-2197.1991.tb14518.x.  
[10] P.G. Mahlberg, E.S. Kim, Accumulation of cannabinoids in glandular trichomes of  cannabis (Cannabaceae), J. Ind. Hemp 9 (1) (2004) 15–36, https://doi.org/  10.1300/J237v09n01_04.  
[11] S. Sirikantaramas, F. Taura, Y. Tanaka, Y. Ishikawa, S. Morimoto, Y. Shoyama,  Tetrahydrocannabinolic acid synthase, the enzyme controlling marijuana  psychoactivity, is secreted into the storage cavity of the glandular trichomes, Plant  Cell Physiol. 46 (9) (2005) 1578–1582, https://doi.org/10.1093/pcp/pci166.  
[12] S.J. Livingston, T.D. Quilichini, J.K. Booth, D.C.J. Wong, K.H. Rensing,  J. Laflamme-Yonkman, S.D. Castellarin, J. Bohlmann, J.E. Page, A.L. Samuels,  Cannabis glandular trichomes alter morphology and metabolite content during  flower maturation, Plant J. 101 (2019) 37–56, https://doi.org/10.1111/tpj.14516.  
[13] C.A.S. Tanney, R. Backer, A. Geitmann, D.L. Smith, Cannabis glandular trichomes:  a cellular metabolite factor, Front. Plant Sci. (2021) 12, https://doi.org/10.3389/  fpls.2021.721986.  
[14] J.C. Turner, J.K. Hemphill, P.G. Mahlberg, Gland distribution and cannabinoid  content in clones of Cannabis sativa L, Am. J. Bot. 64 (6) (1977) 687–693, https://  doi.org/10.2307/2441721.  
[15] N. Bergau, A.N. Santos, A. Henning, G.U. Balcke, A. Tissier, Autofluorescence as a  signal to sort developing glandular trichomes by flow cytometry, Front. Plant Sci. 7  (2016), https://doi.org/10.3389/fpls.2016.00949.  
[16] H. Failmezger, B. Jaegle, A. Schrader, M. Hulskamp, A. Tresch, Semi-automated 3D  leaf reconstruction and analysis of trichome patterning from light microscopic  images, PLoS Comput. Biol. 9 (4) (2013), https://doi.org/10.1371/journal.  pcbi.1003029.  
14 
Smart Agricultural Technology 3 (2023) 100111 
D.B. Sutton et al. 
[17] S.V. Mirnezami, T. Young, T. Assefa, S. Prichard, K. Nagasubramanian, S. Sarkar,  S. Sundararajan, M.E. O’Neal, B. Ganapathysubramanian, A. Singh, Automated  trichome counting in soybean using advanced image-processing techniques, Appl.  Plant Sci. 8 (7) (2020) d o i:10.1002%2Faps3.11375.  
[18] V. Rolland, M.R. Farazi, W.C. Conaty, D. Cameron, S. Liu, L. Petersson, W.N. Stiller,  Hairnet: a deep learning model to score leaf hairiness, a key phenotype for cotton  yield, value and insect resistance, Plant Methods 18 (8) (2022), https://doi.org/  10.1186/s13007-021-00820-8.  
[19] T. Overton, A. Tucker, DO-U-Net for segmentation and counting, in: M.R. Berthold,  A. Feelders, G. Krempl (Eds.), Advances in Intelligent Data Analysis XVIII, Springer  International Publishing, 2020, pp. 391–403, https://doi.org/10.1007/978-3-030-  44584-3_31.  
[20] I.F. Sbalzarini, Seeing is believing: quantifying is convincing: computational image  analysis in biology. Focus on Bio-Image Informatics, 2016, pp. 1–39, https://doi.  org/10.1007/978-3-319-28549-8_1.  
[21] F. Cascini, C. Aiello, G. Di Tanna, Increasing delta-9-tetrahydrocannabinol (-9-thc)  content in herbal cannabis over time: systematic review and meta-analysis, Curr.  Drug Abuse Rev. 5 (1) (2012) 32–40, https://doi.org/10.2174/  
1874473711205010032.  
[22] J.K. Booth, J.E. Page, J. Bohlmann, Terpene synthases from Cannabis sativa, PLoS  ONE 12 (3) (2017), https://doi.org/10.1371/journal.pone.0173911.  [23] L.J. Conneely, R. Mauleon, J. Mieog, B.J. Barkla, T. Kretzschmar, Characterization  of the Cannabis sativa glandular trichome proteome, PLoS ONE 16 (4) (2021),  https://doi.org/10.1371/journal.pone.0242633.  
[24] Z.K. Punja, J.E. Holmes, Hermaphroditism in marijuana (Cannabis sativa L.)  inflorescences – impact on floral morphology, seed formation, progeny sex ratios,  and genetic variation, Front. Plant Sci. 11 (2020), https://doi.org/10.3389/  fpls.2020.00718.  
[25] C. Meier, V. Mediavilla, Factors influencing the yield and quality of hemp  (Cannabis sativa L.) essential oil, J. Int. Hemp Assoc. 5 (1998) 16–20.  [26] E. Naim-Feil, E.J. Breen, L.W. Pembleton, L.E. Spooner, G.C. Spangenberg, N.O.  I. Cogan, Empirical evaluation of inflorescences’ morphological attributes for yield  optimization of medicinal cannabis cultivars, Front. Plant Sci. (2022) 13, https://  doi.org/10.3389/fpls.2022.858519.  
[27] J.C. Turner, J.K. Hemphill, P.G. Mahlberg, Interrelationships of glandular  trichomes and cannabinoid content. I. Developing pistillate bracts of Cannabis  sativa L. (Cannabaceae), Bull. Narc. 33 (2) (1981) 59–69.  
[28] E.-.S. Kim, P.G. Mahlberg, Immunochemical localization of tetrahydrocannabinol  (THC) in cryofixed glandular trichomes of cannabis (cannabaceae), Am. J. Bot. 84  (3) (1997) 336–342.  
[29] P.G. Mahlberg, E.S. Kim, Secretory vesicle formation in glandular trichomes of  Cannabis sativa (Cannabaceae, Am. J. Bot. 79 (2) (1992) 166–173, https://doi.org/  10.2307/2445104.  
[30] S.J. Livingston, E.J. Bae, F. Unda, M.G. Hahn, S.D. Mansfield, J.E. Page, A.  L. Samuels, Cannabis glandular trichome cell walls undergo remodeling to store  specialized metabolites, Plant Cell Physiol. 62 (12) (2021) 1944–1962, https://doi.  org/10.1093/pcp/pcab127.  
[31] P. Ebersbach, F. Stehle, O. Kayser, E. Freier, Chemical fingerprinting of single  glandular trichomes of cannabis sativa by coherent anti-Stokes Raman scattering  (CARS) microscopy, BMC Plant Biol. 18 (275) (2018), https://doi.org/10.1186/  s12870-018-1481-4.  
[32] A. Hazekamp, A. Peltenburg, R. Verpoorte, C. Giroud, Chromatographic and  spectroscopic data of cannabinoids from Cannabis sativa L, J. Liquid Chromatogr.  Related Technol. 28 (15) (2005) 2361–2382, https://doi.org/10.1080/  10826070500187558.  
[33] T.H. Lam, S. Chen, Y.B. Ho, Observations on ultraviolet-fluorescent trichomes on  the tepals of narcissus flowers, Plant Sci. Lett. 18 (1980) 115–120.  [34] O. Monago-Marana, I. Duran-Meras, T. Galeano-Diaz, A. Munoz de la Pena,  Fluorescence properties of flavonoid compounds. quantification in paprika samples  using spectrofluorimetry coupled to second order chemometric tools, Food Chem.  196 (2016) 1058–1065, https://doi.org/10.1016/j.foodchem.2015.10.041.  [35] V.V. Roshchina, A.V. Kuchin, V.A. Yashin, Application of autofluorescence for  analysis of medicinal plants, Int. J. Spectrosc. (2017), https://doi.org/10.1155/  2017/7159609.  
[36] N. Bergau, S. Bennewitz, F. Syrowatka, G. Hause, A. Tissier, The development of  type VI glandular trichomes in the cultivated tomato Solanum lycopersicum and a  related wild species S. habrochaites, BMC Plant Biol. 15 (289) (2015), https://doi.  org/10.1186/s12870-015-0678-z.  
[37] M. Sisa, S.L. Bonnet, D. Ferreira, J.H. Van der Westhuizen, Photochemistry of  flavonoids, Molecules 15 (8) (2010) 5196–5245, https://doi.org/10.3390/  molecules15085196.  
[38] N. Reynoud, J. Petit, C. Bres, M. Lahaye, C. Rothan, D. Marion, B. Bakan, The  complex architecture of plant cuticles and its relation to multiple biological  functions, Front. Plant Sci. 12 (2021), https://doi.org/10.3389/fpls.2021.782773.  
[39] L. Espana, J.A. Heredia-Guerrero, J.J. Reina-Pinto, R. Fernandez-Munoz,  A. Heredia, E. Dominguez, Transient silencing of chalcone synthase during fruit  ripening modifies tomato epidermal cells and cuticle properties, Plant Physiol. 166  (3) (2014) 1371–1386, https://doi.org/10.1104/pp.114.246405.  
[40] H. Bargel, C. Neinhuis, Altered tomato fruit cuticle biomechanics of a pleiotropic  non ripening mutant, J. Plant Growth Regul. 23 (2004) 61–75, https://doi.org/  10.1007/s00344-004-0036-0.  
[41] E. Small, S.G.U. Naraine, Size matters: evolution of large drug-secreting resin  glands in elite pharmaceutical strains of cannabis sativa (marijuana), Genet. Resour.  Crop Evol. 63 (2) (2015) 349–359, https://doi.org/10.1007/s10722-015-0254-2.  
15