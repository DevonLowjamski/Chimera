using System;
using UnityEngine;
using System.Collections.Generic;
using System.Linq;
using ProjectChimera.Data.Facilities;
using ProjectChimera.Data.Shared;


namespace ProjectChimera.Data.Cultivation.Plant
{
    /// <summary>
    /// Basic plant instance data structure
    /// Represents a single plant in the cultivation system
    /// </summary>
    [System.Serializable]
    public class PlantInstance
    {
        [Header("Basic Information")]
        public string PlantId;
        public string StrainName;
        public string Species;
        public PlantStrainSO Strain; // Plant strain reference
        public ProjectChimera.Data.Shared.PlantGrowthStage GrowthStage;

        [Header("Location")]
        public Vector3 Position;
        public string ZoneId;
        public int GridX;
        public int GridY;

        [Header("Growth Data")]
        public float Age; // in days
        public float Height; // in cm
        public float Biomass; // in grams
        public float Health; // 0-1 scale
        public float Stress; // 0-1 scale

        [Header("Resource Data")]
        public float WaterLevel; // 0-1 scale
        public float NutrientLevel; // 0-1 scale
        public float EnergyLevel; // 0-1 scale

        [Header("Environmental")]
        public float Temperature;
        public float Humidity;
        public float LightIntensity;
        public float CO2Level;

        [Header("Maintenance")]
        public DateTime LastWatering;
        public DateTime LastFeeding;
        public DateTime LastPruning;
        public DateTime PlantedDate;
        public DateTime HarvestDate;

        [Header("Status")]
        public bool IsAlive;
        public bool IsFlowering;
        public bool HasPests;
        public bool HasDisease;

        // Additional properties for compatibility
        public string PlantID => $"{Strain?.Name ?? "Unknown"}_{PlantedDate.Ticks}";
        public float CurrentHeight { get; set; } = 10f; // Default seedling height
        public PlantGrowthStage CurrentGrowthStage { get; set; } = PlantGrowthStage.Seedling;
        public float AgeInDays { get; set; } = 0f;

        /// <summary>
        /// Get plant age in days
        /// </summary>
        public float GetAgeInDays()
        {
            return (float)(DateTime.Now - PlantedDate).TotalDays;
        }

        /// <summary>
        /// Check if plant needs watering
        /// </summary>
        public bool NeedsWatering(float threshold = 0.3f)
        {
            return WaterLevel < threshold;
        }

        /// <summary>
        /// Check if plant needs nutrients
        /// </summary>
        public bool NeedsNutrients(float threshold = 0.3f)
        {
            return NutrientLevel < threshold;
        }

        /// <summary>
        /// Get overall plant health score
        /// </summary>
        public float GetOverallHealth()
        {
            return (Health + (1f - Stress) + WaterLevel + NutrientLevel) / 4f;
        }

        /// <summary>
        /// Check if plant is ready for harvest
        /// </summary>
        public bool IsReadyForHarvest(float maturityThreshold = 0.8f)
        {
            return Health >= maturityThreshold &&
                   Stress < 0.2f &&
                   GrowthStage == PlantGrowthStage.Flowering;
        }
    }

    /// <summary>
    /// Plant growth data for calculations
    /// </summary>
    [System.Serializable]
    public class PlantGrowthData
    {
        public float GrowthRate;
        public float WaterConsumptionRate;
        public float NutrientConsumptionRate;
        public float EnergyConsumptionRate;
        public float OptimalTemperature;
        public float OptimalHumidity;
        public float OptimalLightIntensity;
        public float OptimalCO2Level;
        public Dictionary<string, float> GeneticModifiers;

        // Methods for compatibility
        public void ProcessDailyGrowth() { /* Daily growth processing logic */ }
        public void CurrentEnvironment() { /* Environment setting logic */ }
    }

    /// <summary>
    /// Plant resource data
    /// </summary>
    [System.Serializable]
    public class PlantResourceData
    {
        public float CurrentWaterLevel;
        public float CurrentNutrientLevel;
        public float CurrentEnergyLevel;
        public float MaxWaterCapacity;
        public float MaxNutrientCapacity;
        public float MaxEnergyCapacity;
        public Dictionary<string, float> NutrientComposition;

        // Additional properties for compatibility
        public float WaterLevel => CurrentWaterLevel;
        public float NutrientLevel => CurrentNutrientLevel;
        public float EnergyReserves => CurrentEnergyLevel;
        public DateTime LastWatering;
        public DateTime LastFeeding;
        public DateTime LastTraining;

        // Methods for compatibility
        public void Water(float amount) => CurrentWaterLevel = System.Math.Min(CurrentWaterLevel + amount, MaxWaterCapacity);
        public void Feed(Dictionary<string, float> nutrients) => CurrentNutrientLevel = System.Math.Min(CurrentNutrientLevel + nutrients.Values.Sum(), MaxNutrientCapacity);
        public void ApplyTraining() { /* Training logic */ }
        public float GetResourceStatus() => (CurrentWaterLevel + CurrentNutrientLevel + CurrentEnergyLevel) / 3f;
        public float GetOptimalWateringSchedule() => MaxWaterCapacity - CurrentWaterLevel;
        public float GetOptimalFeedingSchedule() => MaxNutrientCapacity - CurrentNutrientLevel;
        public void UpdateResources() { /* Update logic */ }
    }

    /// <summary>
    /// Plant harvest data
    /// </summary>
    [System.Serializable]
    public class PlantHarvestData
    {
        public DateTime HarvestDate;
        public float TotalYield; // in grams
        public float THCContent; // percentage
        public float CBDContent; // percentage
        public float QualityScore; // 0-1 scale
        public string HarvestNotes;
        public Dictionary<string, float> TerpeneProfile;

        // Methods for compatibility
        public float CalculateYieldPotential() => TotalYield * QualityScore;
        public HarvestResult Harvest() => new HarvestResult
        {
            PlantID = "Unknown", // Would be set from plant data
            TotalWeightGrams = TotalYield,
            QualityScore = QualityScore
        };
        public bool CheckHarvestReadiness() => QualityScore > 0.7f;
        public string[] GetHarvestRecommendations() => new[] { "Monitor trichome development", "Check pistil browning" };
        public string[] GetPostHarvestProcess() => new[] { "Dry for 5-7 days", "Cure for 2-4 weeks" };
    }

    /// <summary>
    /// Cultural practice for plant care
    /// </summary>
    [System.Serializable]
    public class CulturalPractice
    {
        public string PracticeId;
        public string Name;
        public string Description;
        public PracticeType Type;
        public float FrequencyDays;
        public float DurationHours;
        public float LaborRequired;
        public Dictionary<string, float> Effects;

        public enum PracticeType
        {
            Watering,
            Fertilizing,
            Pruning,
            Training,
            PestControl,
            Harvesting
        }
    }
}
