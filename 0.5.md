# **Phase 0.5: Foundation Completion & Quality Gates**

Based on the three reviews, here's a concise implementation plan to address all critical concerns before proceeding to Phase 1\. This phase should take **5-7 days** to complete.

## **ðŸš¨ Critical Blockers (Must Fix)**

### **Day 1: Quality Gates & Regression Prevention**

**Goal:** Prevent immediate regression of completed work

\# .github/workflows/quality-gate.yml  
\- Create simple grep-based CI check for:  
  \- FindObjectOfType( â†’ FAIL  
  \- Resources.Load( â†’ FAIL    
  \- Debug.Log( outside Systems/Diagnostics â†’ FAIL  
  \- GetComponent in Awake/Start/Update â†’ WARN

**Implementation:**

* Add pre-commit hook locally  
* GitHub Action for PR validation  
* Mark build as failed if violations found  
* **Time: 3-4 hours**

### **Days 2-4: Complete DI Unification**

**Goal:** Eliminate all 323 FindObjectOfType calls

**Priority Files (84 total):**

// Top offenders to fix first:  
SchematicLibraryManager.cs  
ConstructionManager.cs    
GridPlacementController.cs  
CultivationManager.cs

**Pattern to apply:**

// BEFORE:  
\_libraryPanel \= FindObjectOfType\<SchematicLibraryPanel\>();

// AFTER:  
\_libraryPanel \= ServiceContainer.Resolve\<ISchematicLibraryPanel\>();

**Steps:**

1. Create missing interfaces for all components  
2. Register in ServiceBootstrapper comprehensively  
3. Add dependency validation at startup  
4. Replace all FindObjectOfType calls systematically

### **Days 5-6: Implement Central Update Bus**

**Goal:** Remove fragmented Update() methods

// Core/Updates/ITickable.cs  
public interface ITickable {  
    void Tick(float deltaTime);  
    int Priority { get; }  
    bool Enabled { get; }  
}

// Core/Updates/UpdateOrchestrator.cs  
public class UpdateOrchestrator {  
    private readonly SortedList\<int, ITickable\> \_tickables;  
      
    public void RegisterTickable(ITickable tickable) { }  
    public void UnregisterTickable(ITickable tickable) { }  
      
    // Called once from DIGameManager.Update()  
    public void TickAll(float deltaTime) {  
        foreach(var tickable in \_tickables.Where(t \=\> t.Enabled)) {  
            tickable.Tick(deltaTime);  
        }  
    }  
}

**Migration targets:**

* CultivationManager.Update() â†’ ITickable.Tick()  
* All system Update() methods â†’ Centralized ticking  
* Remove individual MonoBehaviour.Update() calls

## **âš¡ Quick Wins (Day 7\)**

### **1\. ServiceLocator Deprecation**

\[Obsolete("Use ServiceContainer instead", error: true)\]  
public class ServiceLocator { }

### **2\. Build Profiles & Script Defines**

// ProjectSettings â†’ Player â†’ Scripting Define Symbols  
CHIMERA\_DEV\_LOGS      // Dev \+ Editor builds  
CHIMERA\_VERBOSE\_INIT  // Dev builds only  
CHIMERA\_ASSERTS       // Dev \+ Editor builds

### **3\. Debug.Log Wrapper**

// Systems/Diagnostics/ChimeraLogger.cs  
public static class ChimeraLogger {  
    \[Conditional("CHIMERA\_DEV\_LOGS")\]  
    public static void Log(string message) { }  
}

### **4\. Service Registration Report**

// At end of ServiceBootstrapper.Initialize()  
\#if CHIMERA\_VERBOSE\_INIT  
    LogServiceRegistrations();  // Lists all registered services  
    ValidateDependencyGraph();  // Checks for missing deps  
\#endif

## **ðŸ“‹ Validation Checklist**

Before proceeding to Phase 1, verify:

* \[ \] **Zero FindObjectOfType** in runtime assemblies (CI enforced)  
* \[ \] **Zero Resources.Load** calls (or documented exceptions)  
* \[ \] **All Debug.Log** routed through ChimeraLogger  
* \[ \] **ServiceLocator marked \[Obsolete\]** with compile error  
* \[ \] **UpdateOrchestrator** handling all system updates  
* \[ \] **Quality gate CI** blocking bad PRs  
* \[ \] **Build profiles** configured (Editor/Dev/Release)  
* \[ \] **Service registration validation** at startup

## **ðŸŽ¯ Success Metrics**

| Metric | Current | Target |
| ----- | ----- | ----- |
| FindObjectOfType calls | 323 | 0 |
| Individual Update() methods | \~100+ | \<10 |
| Direct Debug.Log calls | 2300+ | 0 |
| Service registration failures | Unknown | 0 |
| CI gate violations per week | N/A | \<5 |

## **ðŸ“… Execution Order**

1. **FIRST:** Quality gates (prevents regression during fixes)  
2. **SECOND:** DI unification (largest surface area)  
3. **THIRD:** Central Update Bus (architectural foundation)  
4. **LAST:** Quick wins & validation

## **ðŸš« What NOT to Do**

* Don't start Phase 1 until ALL items are checked  
* Don't skip the quality gates "just this once"  
* Don't leave "temporary" FindObjectOfType calls  
* Don't merge PRs that fail quality checks

## **âœ… Definition of Done**

Phase 0.5 is complete when:

* Running the quality gate script returns **zero violations**  
* The project compiles with ServiceLocator marked obsolete  
* All systems use ITickable instead of Update()  
* A new developer can register a service following the docs  
* The CI automatically rejects PRs with anti-patterns

---

**Time Investment:** 5-7 days  
 **Risk if Skipped:** High (immediate regression, Phase 1 complications)  
 **ROI:** Prevents 20-30 days of rework in later phases

Once Phase 0.5 is complete, you'll have a **truly stable foundation** for the aggressive refactoring in Phase 1\.

